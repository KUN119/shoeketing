<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="CS">

<!-- 나의 매장 문의 리스트 -->
<select id="selectCSList" parameterType="hashmap" resultType="hashmap">
<![CDATA[
	SELECT
			CS_NUM,
			CS_TITLE,
			TO_CHAR(CS_DATE, 'YYYY.MM.DD') AS CS_DATE,
			TO_CHAR(CS_DATE, 'HH24:MI:SS') AS CS_TIME
	FROM (SELECT
				ROWNUM RNUM,
				T1.*
		  FROM (SELECT /*+ INDEX_DESC(CS PK_CS) */ *
					FROM CS
					WHERE CS_DEL_GB='N'
					AND CS_WRITER=#{MEM_NUM}) T1
			WHERE ROWNUM <= #{END})
		WHERE RNUM >= #{START}
				AND CS_DEL_GB='N'
]]>
</select>

<!-- 나의 문의 내역 개수 가져오기 -->
<select id="selectCSCount" parameterType="hashmap" resultType="int">
<![CDATA[
	SELECT COUNT(*) AS CS_COUNT
	FROM CS
	WHERE CS_WRITER = #{MEM_NUM}
		AND CS_DEL_GB='N'
]]>
</select> 

<!-- 지점 리스트 가져오기 -->
<select id="selectShopList" parameterType="hashmap" resultType="hashmap">
<![CDATA[
	SELECT
		RNUM,
		SHOP_NUM,
		SHOP_NAME,
		SHOP_ADD
	FROM (SELECT
				ROWNUM RNUM,
				T1.*
		  FROM (SELECT
					/*+ INDEX_DESC(SHOP PK_SHOP) */ *
					FROM SHOP
					WHERE SHOP_DEL_GB='N'
						AND SHOP_JOIN_APPROVE='Y') T1
		  WHERE ROWNUM<=#{END}
		 <include refid="shopSearch"/>)
	WHERE RNUM>=#{START};
]]>
</select>

<!-- 매장으로 문의하기 작성 -->
<insert id="insertCS" parameterType="hashmap">
<![CDATA[
INSERT INTO CS
				(CS_NUM,
				CS_SHOP_NUM,
				CS_TITLE,
				CS_CONTENT,
				CS_DATE)
VALUES (CS_SEQ.NETVAL,
		#{CS_SHOP_NUM},
		#{CS_TITLE},
		#{CS_CONTENT},
		SYSDATE
		)
]]>
</insert>

<!-- 지점 리스트 가져오기 -->
<select id="selectShopListSearch" parameterType="hashmap" resultType="hashmap">
<![CDATA[
	SELECT
		RNUM,
		SHOP_NUM,
		SHOP_NAME,
		SHOP_ADD
	FROM (SELECT
				ROWNUM RNUM,
				T1.*
		  FROM (SELECT
					/*+ INDEX_DESC(SHOP PK_SHOP) */ *
					FROM SHOP
					WHERE SHOP_DEL_GB='N'
						AND SHOP_JOIN_APPROVE='Y') T1
		  WHERE ROWNUM<=#{END}
]]>		 <include refid="shopSearch"/> <![CDATA[)
	WHERE RNUM>=#{START};
]]>
</select>

<!-- 검색조건  -->
<sql id="shopSearch">
		<if test="keyword != null">
			AND SHOP_NAME LIKE '%' || #{keyword} || '%'
		</if>
</sql>

<!-- 지점 리스트 개수 가져오기 -->
<select id="selectShopCount" parameterType="hashmap" resultType="int">
<![CDATA[
	SELECT COUNT(*) AS SHOP_COUNT
	FROM SHOP
	WHERE SHOP_DEL_GB='N'
		AND SHOP_JOIN_APPROVE='Y'
]]>		
	<include refid="shopSearch"/>
</select>


<!-- 문의 내역 글 상세보기 (글만) -->
<select id="selectCSDetail" parameterType="hashmap" resultType="hashmap">
<![CDATA[
	SELECT
			CS_NUM,
			CS_TITLE,
			TO_CHAR(CS_DATE, 'YYYY.MM.DD') AS CS_DATE,
			TO_CHAR(CS_DATE, 'HH24:MI:SS') AS CS_TIME
	FROM (SELECT
				ROWNUM RNUM,
				T1.*
		  FROM (SELECT /*+ INDEX_DESC(CS PK_CS) */ *
					FROM CS
					WHERE CS_DEL_GB='N'
					AND CS_WRITER=#{MEM_NUM}) T1
			WHERE ROWNUM <= #{END})
		WHERE RNUM >= #{START}
]]>
</select>

<!-- 문의 댓글 가져오기 -->
<select id="selectCSReply" parameterType="hashmap" resultType="hashmap">
<![CDATA[
SELECT
		CS_REPLY_NUM,
		CS_REPLY_CONTENT,
FROM CS_REPLY
WHERE CS_REPLY_NUM = #{CS_NUM}
]]>
</select> 

<!-- 삭제는 트리거 작성 후 추가 예정  -->
</mapper>