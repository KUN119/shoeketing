<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="memberPage">


<!-- 회원정보 가져오기 -->
<select id="selectAccountInfo" parameterType="hashmap" resultType="hashmap">
<![CDATA[
	SELECT
			MEM_NAME,
			MEM_PHONE,
			MEM_INFORM_AGREE,
			MEM_GRADE
FROM MEMBER
WHERE MEM_NUM=#{MEM_NUM}
	  AND MEM_DEL_GB = 'N'
]]>
</select>


<!-- 회원 정보 수정 -->
<update id="updateAccountModify" parameterType="hashmap">

<![CDATA[
UPDATE MEMBER
SET
	MEM_PW=#{MEM_PW},
	MEM_INFORM_AGREE = #{MEM_INFORM_AGREE}
WHERE MEM_NUM = #{MEM_NUM}
]]>
</update>

<!-- 탈퇴 전 비밀번호 확인 -->
<select id="selectPw" parameterType="hashmap" resultType="hashmap">
<![CDATA[
	SELECT
			MEM_PW
	FROM MEMBER
	WHERE MEM_EMAIL = #{MEM_EMAIL}
		  AND MEM_DEL_GB='N'
]]>
</select>

<!-- 예약상태 가져오기 (탈퇴 전) -->
<select id="selectReservationStatus" resultType="int" parameterType="hashmap">
<![CDATA[
	SELECT
			COUNT(*) AS RESERVATION_COUNT
	FROM RESERVATION
	WHERE RESERVATION_USER = #{MEM_NUM}
		  AND RESERVATION_DEL_GB = 'N'
		  AND RESERVATION_STATUS = '픽업 대기중'
]]>
</select>

<!-- 회원 탈퇴 -->
<update id="deleteAccount" parameterType="hashmap">
<![CDATA[
UPDATE MEMBER
SET
	MEM_DEL_GB = 'Y',
	MEM_DEL_TIME = SYSDATE
WHERE MEM_NUM=#{MEM_NUM}
]]>
</update>


</mapper>
